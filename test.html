<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>SoundOff test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <script src="jquery.js"></script>
    <script type="text/javascript">
      var SoundOff = {
        swfLocation : 'soundoff.swf',
        containerID : '_soundOffContainer',
        container : null,
        list : []
      };
      
      SoundOff.Object = function() {
        if (!SoundOff.container) {
          var c = document.createElement('div');
          c.style.position = 'absolute';
          c.style.top = 0;
          c.style.left = 0;
          document.body.appendChild(c);
          SoundOff.container = c;
        }
        
        fo = document.createElement('object');
        fo.setAttribute('type', "application/x-shockwave-flash");
        fo.setAttribute('data', SoundOff.swfLocation);
        fo.setAttribute('height', 1);
        fo.setAttribute('width', 1);
        fo.style.position = 'absolute';
        fo.style.top = 0;
        fo.style.left = 0;
        
        SoundOff.container.appendChild(fo);
        this.flashObj = fo;
        this.initializeTimer = setInterval(this.bind(this.isInitialized, this), 100);
        SoundOff.list.push(this);
        this.thisIndex = SoundOff.list.length - 1;
        this.deferredCalls.push(['setUID', this.thisIndex]);
      }
      
      SoundOff.Object.prototype = {
        initialized : false,
        initializeTimer : null,
        deferredCalls : [],
        events : {},
        thisIndex : null,
        
        addToList : function(id, filePath) {
          this.call('addToList', arguments);
        },
        
        removeFromList : function(id) {
          this.call('removeFromList', arguments);
        },
        
        play : function(pos) {
          if (arguments[0] === null) { arguments[0] = -1;}
          this.call('play', arguments);
        },
        
        playNext : function() {
          this.call('playNext');
        },
        
        playPrev : function() {
          this.call('playPrev');
        },
        
        stop : function() {
          this.call('stop');
        },
        
        pause : function() {
          this.call('pause');
        },
        
        /* for internal use only */
        call : function() {
          var methodName = arguments[0];
          var i, args = [], a, ta;
          ta = typeof arguments[1] ==  'object' ? arguments[1] : arguments;
          for (i = typeof arguments[1] ==  'object' ? 0 : 1; a = ta[i]; i++) { args.push(a); }
          if (this.initialized) {
            this.flashObj.call(methodName, args);
          } else {
            this.deferredCalls.push(['call', methodName, args]);
          }
        },
        
        /* Use this to set the value of a variable on the player */
        setVal : function(name, val) {
          if (this.initialized) {
            this.flashObj.set(name, val);
          } else {
            this.deferredCalls.push('set', name, val);
          }
        },
        
        /* Use this to get the value of a variable on the player. If the flash
          player is not initialized, this will return null.
          The only other solution that I could think of was to freeze the
          browser with a loop until it became available, but this would be
          bad if the player never initalized for some reason. */
        getVal : function(name) {
          if (this.initialized) {
            return this.flashObj.get(name);
          } else {
            return null;
          }
        },
        
        /* for internal use only */
        isInitialized : function() {
          try {
            this.flashObj.initialize();
            this.initialized = true;
            clearInterval(this.initializeTimer);
            var i, a;
            for (var i=0; a = this.deferredCalls[i]; i++ ) {
              switch(a.length) {
                case 2:
                  this[a[0]](a[1]);
                  break;
                case 3:
                  this[a[0]](a[1], a[2]);
                  break;
              }
              
            }
          } catch(e) {}
        },
        
        /* for internal use only */
        bind : function (f, obj) {
          return function() { return f.apply(obj, arguments); };
        },
        
        /* for internal use only */
        setUID : function(uid) {
          this.flashObj.uid(uid);
        },
        
        addEvent : function(event, func) {
          var i, e;
          this.events[event] = this.events[event] || [];
          for (i=0; e = this.events[event][i]; i++) { if (func === e) { return false; } }
          this.events[event].push(func);
          return true;
        },
        
        removeEvent : function(event, func) {
          var i, e;
          this.events[event] = this.events[event] || [];
          for (i=0; e = this.events[event][i]; i++) {
            if (func === e) {
              this.events[event].splice(i, 1);
              break;
            }
          }
        },
        
        dispatchEvent : function (event, obj) {
          
          console.info('Dispatching event: ' + event);
          console.info(obj);
          
          var i, e;
          this.events[event] = this.events[event] || [];
          for (i=0; e = this.events[event][i]; i++) { e.apply(this, obj); }
        }
      };
      
      
      $(function() {
        var so = new SoundOff.Object();
        so.addToList('1', 'songs/suntorise.mp3');
        so.addToList('2', 'songs/purpledress.mp3');
        so.play();
        
        $('#playNext').click(function() { so.playNext(); });
        $('#playPrev').click(function() { so.playPrev(); });
        $('#pause').click(function() { so.pause(); });
        $('#play').click(function() { so.play();} );
        
      });
    </script>
  </head>
  <body>
    <div>
      <button id="pause">Pause</button>
      <button id="play">Play</button>
      <button id="playPrev">Play Previous</button>
      <button id="playNext">Play Next</button>
    </div>
  </body>
</html>